{{/* Tag Filter List */}}
<div class="mb-5">
  <div class="d-flex flex-wrap justify-content-center gap-2">
    {{/* All button (Homepage link) */}}
    <a href="{{ .Site.Home.RelPermalink }}" class="btn btn-outline-primary {{ if .IsHome }}active{{ end }}">
      <i class="fa-solid fa-grid-2 me-2"></i>
      {{ i18n "all_topics" | default "All" }}
    </a>

    {{/* Build a sorted list of tags by extensions count */}}
    {{- $tagList := slice }}
    {{- range $tagName, $taxonomy := .Site.Taxonomies.tags }}
      {{/* Count only pages with "extensions" category */}}
      {{- $extensionsCount := 0 }}
      {{- range $taxonomy.Pages }}
        {{- if in .Params.categories "extensions" }}
          {{- $extensionsCount = add $extensionsCount 1 }}
        {{- end }}
      {{- end }}
      {{- if gt $extensionsCount 0 }}
        {{- $tagList = $tagList | append (dict "Page" $taxonomy.Page "TagName" $tagName "Count" $extensionsCount) }}
      {{- end }}
    {{- end }}

    {{/* Sort by count descending */}}
    {{- range sort $tagList "Count" "desc" }}
      {{- $isActive := false }}
      {{- if $.Param "term" }}
        {{- if eq $.Param "term" .Page.Title }}
          {{- $isActive = true }}
        {{- end }}
      {{- end }}
      {{/* Construct tag URL - fallback to manual construction if page doesn't exist */}}
      {{- $tagURL := "" }}
      {{- if .Page }}
        {{- $tagURL = .Page.RelPermalink }}
      {{- else }}
        {{- $tagURL = printf "/topics/%s/" (.TagName | urlize) }}
      {{- end }}
      <a href="{{ $tagURL }}" class="btn btn-outline-primary {{ if $isActive }}active{{ end }}">
        {{ .Page.Title | default .TagName }}
        <span class="badge bg-primary text-white ms-1">{{ .Count }}</span>
      </a>
    {{- end }}
  </div>
</div>
